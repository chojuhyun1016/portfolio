# 📦 order-batch

`order-batch` 모듈은 주문 도메인에 대한 **정기/비정기 배치 처리**를 담당하는 컴포넌트입니다.  
Kafka DLQ 재처리, 주기적인 정산, 예약된 리포트 생성 및 업로드 등 **시간 기반의 반복 작업 및 대량 데이터 처리**를 수행합니다.

이 모듈은 `order-core`, `order-client` 등의 내부 모듈과 협력하여 비즈니스 배치 요구사항을 반영하며,  
**효율적이고 안정적인 배치 시스템**을 구성하는 기반 역할을 합니다.

---

## 🧭 모듈 목적 및 주요 기능

- Kafka DLQ 메시지 재처리 및 discard 로직 수행
- 일정 주기로 실행되는 배치 Job 정의 (Quartz, Scheduler 등과 연계 가능)
- 파일 생성/업로드/백업과 관련된 반복 작업 수행
- 외부 연동 실패 대응을 위한 **재시도 및 Fallback 처리**
- 운영 배치를 위한 Lock 기반의 중복 실행 방지

---

## 📂 패키지 구조 및 설명

### 🔹 `service.retry`

- DLQ(Kafka) 메시지 재처리 관련 로직 정의
- 실패 횟수에 따라 재시도 또는 discard 처리
- 메시지 타입별 전략 분리 및 유연한 확장 가능
- 사용 예:
    - `ORDER_LOCAL`, `ORDER_API` 메시지 재처리
    - 실패 횟수 초과 시 `discard` 토픽으로 라우팅

---

### 🔹 `service.synchronize`

- 외부 시스템과의 정기적 동기화 로직
- 특정 시간 간격으로 실행되는 데이터 수집 및 처리 Job 구현
- 사용 예:
    - S3에 로그 또는 리포트 업로드
    - 외부 정산 시스템으로의 데이터 전달

---

### 🔹 `config`

- 배치 관련 설정 클래스 정의 (예: Lock, Scheduler, Retry 등)
- Kafka Consumer 설정, Job 등록 설정 포함
- Lock 설정: `MySQL GET_LOCK`, `Redis-based Lock` 지원 가능

---

## 🔗 의존성 및 설계 원칙

- **MSA 배치 모듈로서 독립성 유지**: 다른 모듈로부터 최소한의 의존성만 유지
- **클린 아키텍처 기반 역할 분리**: `core`, `client` 모듈과의 명확한 경계 유지
- **Retry, Logging, Alerting** 등의 인프라 대응 로직은 batch 모듈 내에서 통합 관리
- **외부 리소스와의 충돌 방지를 위한 Named Lock 전략 사용**

---

## ✅ 결론

`order-batch` 모듈은 주문 시스템의 **비동기/예약 처리 요구사항을 책임지는 배치 처리 전용 모듈**로,  
안정적인 운영과 효율적인 데이터 흐름을 위한 **핵심 인프라 구성 요소**입니다.  
유지보수성과 확장성을 고려하여 설계되었으며, **실시간 트랜잭션과 배치 프로세스의 명확한 분리를 보장**합니다.