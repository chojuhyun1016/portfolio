# order-core:application:messaging ν¨ν‚¤μ§€ κµ¬μ΅° λ° μ—­ν•  μ •λ¦¬

λ³Έ λ””λ ‰ν† λ¦¬λ” `order-core` λ¨λ“μ λ©”μ‹μ§• κΈ°λ¥μ„ λ‹΄λ‹Ήν•λ” κµ¬μ„± μ”μ†λ¥Ό μ •μν•λ©°, λ©”μ‹μ§€ μ „μ†΅, DLQ(Died Letter Queue), λ©”μ‹μ§€ μΉ΄ν…κ³ λ¦¬, λ©”μ‹μ§€ κ°μ²΄ λ¨λΈ λ“±μΌλ΅ κµ¬μ„±λλ‹¤.  
MSA ν™κ²½μ—μ„ Kafka, Redis, MQ κΈ°λ° λ©”μ‹μ§• μ‹μ¤ν…μ„ μ—°κ³„ν•  μ μλ„λ΅ μ„¤κ³„λμ–΄ μμΌλ©°, λ©”μ‹μ§€μ λ°μ‹ /μμ‹ /λ³€ν™/λ¶„λ¥/μ—λ¬ μ²λ¦¬ λ“±μ μ—­ν• μ„ μν–‰ν•λ‹¤.

---

## π“ common

### π“ code

- κ³µν†µ λ©”μ‹μ§•μ—μ„ μ‚¬μ©ν•λ” `Enum` μ •μ μ„μΉ
- μ: `MessageMethodType`, `CodeEnum` λ“± λ©”μ‹μ§€ ν–‰μ„, μ½”λ“ λ¶„λ¥ κΈ°μ¤€ μ •μ

### π“ message

- λ©”μ‹μ§€μ κΈ°λ³Έ ν΄λμ¤ μ •μ μ„μΉ
- `DlqMessage` λ“± κ³µν†µ λ©”μ‹μ§€ λ² μ΄μ¤ ν΄λμ¤ ν¬ν•¨
- λ¨λ“  μ„λΉ„μ¤ λ©”μ‹μ§€λ” μ΄ ν΄λμ¤λ¥Ό μƒμ†λ°›μ•„ μ‚¬μ©

---

## π“ order

### π“ code

#### DlqOrderType.java

- `DlqType` μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• `Order` μ„λΉ„μ¤ μ „μ© DLQ μ ν• Enum
- μ‹¤ν¨ν• λ©”μ‹μ§€λ¥Ό DLQλ΅ λΌμ°ν…ν•  λ• μ‚¬μ©λλ” κµ¬λ¶„κ°’
- κ°’ λ©λ΅:
    - ORDER_LOCAL
    - ORDER_API
    - ORDER_CRUD
    - ORDER_REMOTE

> **μ©λ„:** λ©”μ‹μ§€ μ „μ†΅ μ‹¤ν¨ μ‹, ν•΄λ‹Ή λ©”μ‹μ§€λ¥Ό μ–΄λ–¤ DLQ μ±„λ„λ΅ λ³΄λ‚Όμ§€ λ…μ‹

#### MessageCategory.java

- `CodeEnum` μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν• λ©”μ‹μ§€ λ¶„λ¥μ© Enum
- μ „μ²΄ λ©”μ‹μ§€ νλ¦„ νΉμ€ κµ¬λ… μ²λ¦¬ μ‹ λ©”μ‹μ§€ μΉ΄ν…κ³ λ¦¬λ¥Ό μ‹λ³„ν•λ” λ° μ‚¬μ©
- κ°’ λ©λ΅:
    - ORDER_LOCAL, ORDER_API, ORDER_CRUD, ORDER_REMOTE, ORDER_DLQ, ORDER_ALARM

> **μ©λ„:** Kafka Topic, λ΅κ·Έ ν•„ν„°λ§, λ¨λ‹ν„°λ§ λ“±μ—μ„ λ©”μ‹μ§€ λ²”μ£Ό κµ¬λ¶„

---

### π“ message

#### OrderLocalMessage.java

- λ©”μ‹μ§€ μƒμ„± μ‹ κ°€μ¥ μµμ΄μ— μƒμ„±λλ” λ΅μ»¬ λ©”μ‹μ§€
- μ΄ν›„ λ‹¤λ¥Έ λ©”μ‹μ§€(`OrderApiMessage`, `OrderCrudMessage`)λ΅ λ³€ν™λμ–΄ μ‚¬μ©λ¨
- ν•„λ“:
    - id: λ©”μ‹μ§€ λ€μƒ ID
    - methodType: μƒμ„±/μμ •/μ‚­μ  λ“±
    - publishedTimestamp: λ©”μ‹μ§€ μµμ΄ λ°ν–‰ μ‹κ°

> **μ©λ„:** λ‚΄λ¶€ μ΄λ²¤νΈ λ°μƒμ μ‹μ‘μ . μ ν¨μ„± κ²€μ‚¬ λ° ν›„μ† λ©”μ‹μ§€λ΅ λ³€ν™

#### OrderApiMessage.java

- μ™Έλ¶€ API λλ” μ„λΉ„μ¤λ΅ μ „μ†΅λλ” λ©”μ‹μ§€ ν¬λ§·
- `OrderLocalMessage`μ—μ„ λ³€ν™λ¨
- DLQ μ ν•: ORDER_API

> **μ©λ„:** μ™Έλ¶€ API μ—°λ™ μ΄λ²¤νΈ μ „ν

#### OrderCloseMessage.java

- μ£Όλ¬Έ λ§κ°(close) μ΄λ²¤νΈ μ „μ© λ©”μ‹μ§€
- μ£Όλ¬Έ IDμ™€ λ™μ‘ νƒ€μ…μ„ ν¬ν•¨
- DLQ μ ν•: ORDER_REMOTE

> **μ©λ„:** μ£Όλ¬Έ λ§κ° μ΄λ²¤νΈλ¥Ό μ™Έλ¶€ μ‹μ¤ν… λλ” λ‹¤λ¥Έ μ»¨ν…μ¤νΈλ΅ μ „λ‹¬

#### OrderCrudMessage.java

- CRUD μ΄λ²¤νΈ μ²λ¦¬ λ©”μ‹μ§€
- λ‚΄λ¶€ DTOμ™€ λ©”μ‹μ§€ ν–‰μ„ μ •λ³΄ ν¬ν•¨
- DLQ μ ν•: ORDER_CRUD

> **μ©λ„:** μ£Όλ¬Έ μƒμ„±/μμ •/μ‚­μ  μ‹ κ΄€λ ¨ μ„λΉ„μ¤λ΅ μ „ν

---

## β… λ©”μ‹μ§€ νλ¦„ μ”μ•½

    OrderLocalMessage (λ°μƒ μ›λ³Έ)
        β†“ toMessage()
    OrderApiMessage / OrderCloseMessage λ“± (API / Remote μ†΅μ‹ μ©)
        β†“ toMessage()
    OrderCrudMessage (CRUD λ™μ‘ λ€μƒ μ „λ‹¬)

---

## π“ μ„¤κ³„ μλ„ λ° ν™•μ¥μ„± κ°€μ΄λ“

- **Enum λ¶„λ¦¬ κ΄€λ¦¬**: λ©”μ‹μ§€ νƒ€μ…λ³„ λ…ν™•ν• μ±…μ„κ³Ό κ²½κ³„ μ μ§€
- **λ‹¨μΌ μ±…μ„ λ©”μ‹μ§€ ν΄λμ¤**: μ μ§€λ³΄μμ„±κ³Ό ν…μ¤νΈ μ©μ΄μ„± ν–¥μƒ
- **μ ν¨μ„± κ²€μ‚¬ λ‚΄μ¥**: OrderLocalMessage μƒμ„± μ‹ ν•„μκ°’ κ²€μ¦
- **DlqMessage μƒμ† κµ¬μ΅°**: μΌκ΄€λ λ©”μ‹μ§€ μ²λ¦¬ νλ¦„ ν™•λ³΄

---

## π“¦ ν™•μ¥ κ³ λ ¤ μ‚¬ν•­

1. **Kafka Topic λ§¤ν•‘ λ…μ‹**
    - λ©”μ‹μ§€ νƒ€μ… β†’ Topic μ΄λ¦„ λ…ν™•ν™”
    - μ: `ORDER_API β†’ topic.order.api`

2. **DLQ λ©”μ‹μ§€ λ³µκµ¬ μ²λ¦¬**
    - `DlqType` κΈ°λ° λ©”μ‹μ§€ λ¨λ‹ν„°λ§ λ° μ¬μ²λ¦¬ μ„¤κ³„ ν•„μ”

3. **MessageCategory κΈ°λ° λ©”νΈλ¦­ λ¶„λ¥**
    - Prometheus, ELK λ“± μ—°λ™ μ‹ μΉ΄ν…κ³ λ¦¬λ³„ μ§‘κ³„ κ°€λ¥

---

## π“ κµ¬μ΅° μ”μ•½

| μμ—­             | μ„¤λ…                                                    |
|------------------|---------------------------------------------------------|
| `code`           | λ©”μ‹μ§€ λ¶„λ¥, DLQ νƒ€μ…, μΉ΄ν…κ³ λ¦¬ μ •μ                     |
| `message`        | κ° λ©”μ‹μ§€ νμ΄λ΅λ“ ν΄λμ¤ μ •μ                           |
| `common.message` | λ©”μ‹μ§€ λ² μ΄μ¤ ν΄λμ¤(DlqMessage)                         |
| `common.code`    | κ³µν†µ λ©”μ‹μ§€ λ™μ‘(Enum), μ½”λ“ μΈν„°νμ΄μ¤ μ •μ            |

> ν¨ν‚¤μ§€ λ¶„λ¦¬λ” λ…ν™•ν• μ±…μ„ κ²½κ³„λ¥Ό μ μ§€ν•λ©°, ν™•μ¥μ„±Β·μ μ§€λ³΄μμ„±μ„ κ³ λ ¤ν• κµ¬μ΅°μ…λ‹λ‹¤.
