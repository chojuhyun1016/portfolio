# ğŸ” Crypto í‚¤ ê´€ë¦¬ / ì•”í˜¸í™” ëª¨ë“ˆ (order-core / infra.crypto)

ë³¸ ë¬¸ì„œëŠ” `org.example.order.core.infra.crypto` íŒ¨í‚¤ì§€ì˜ **í˜„ì¬ ì½”ë“œ ìƒíƒœë¥¼ ê¸°ì¤€**ìœ¼ë¡œ ì‘ì„±ëœ
**ê³µì‹ README.md** ì´ë‹¤.  
ê¸°ì¡´ ë¶„ì„ ë¬¸ì„œì˜ **êµ¬ì¡°Â·ë°€ë„Â·ì„¤ê³„ ê´€ì **ì„ ìœ ì§€í•˜ë˜, ì‹¤ì œ êµ¬í˜„ê³¼ ì–´ê¸‹ë‚œ ë‚´ìš©ì€ ëª¨ë‘ ì œê±°Â·í˜„í–‰í™”í•˜ì˜€ë‹¤.

-------------------------------------------------------------------------------

## 1. ëª¨ë“ˆ ëª©ì  ë° ìœ„ì¹˜

### 1.1 ëª©ì 

- AES / HMAC ê¸°ë°˜ **ì•”Â·ë³µí˜¸í™”, ì„œëª…, í•´ì‹œ ê¸°ëŠ¥ í‘œì¤€í™”**
- Secrets, TSID, Kafka, Web, S3 ì¸í”„ë¼ì™€ **ë™ì¼í•œ êµ¬ì„± íŒ¨í„´**
- **ì„¤ì • ê¸°ë°˜ ON/OFF** ë° í™˜ê²½ë³„ ë™ì‘ ì „í™˜
- ì„œë¹„ìŠ¤ ì½”ë“œì—ì„œ ì•”í˜¸ ì•Œê³ ë¦¬ì¦˜ ë³€ê²½ ì‹œ **ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”**

### 1.2 íŒ¨í‚¤ì§€ ìœ„ì¹˜

    org.example.order.core.infra.crypto
    â”œâ”€ algorithm
    â”‚  â”œâ”€ encryptor
    â”‚  â”œâ”€ hasher
    â”‚  â””â”€ signer
    â”œâ”€ config
    â”œâ”€ constant
    â”œâ”€ contract
    â”œâ”€ exception
    â”œâ”€ factory
    â”œâ”€ props
    â””â”€ util

-------------------------------------------------------------------------------

## 2. ì „ì²´ êµ¬ì„± ê°œìš”

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
|----------|------|
| CryptoInfraConfig | crypto ì¸í”„ë¼ ë‹¨ì¼ ì§„ì…ì  |
| Encryptor | AES128 / AES256 / AES-GCM ì•”Â·ë³µí˜¸í™” |
| Signer | HMAC-SHA256 ì„œëª…/ê²€ì¦ |
| Hasher | Bcrypt / Argon2 / SHA256 |
| EncryptorFactory | CryptoAlgorithmType â†’ êµ¬í˜„ì²´ ë§¤í•‘ |
| EncryptProperties | encrypt.* ì„¤ì • ë°”ì¸ë”© |
| EncryptionKeyGenerator | SecureRandom ê¸°ë°˜ í‚¤ ìƒì„± |

-------------------------------------------------------------------------------

## 3. í™œì„± ì¡°ê±´ ë° ì „ì—­ ì›ì¹™

### 3.1 í™œì„± ì¡°ê±´

    crypto.enabled=true

ìœ„ ì¡°ê±´ì´ ë§Œì¡±ë˜ì§€ ì•Šìœ¼ë©´ **Crypto ê´€ë ¨ ë¹ˆì€ ë‹¨ í•˜ë‚˜ë„ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤.**

### 3.2 ì„¤ê³„ ì›ì¹™ (ê°•ì œ ê·œì¹™)

- ê¸°ë³¸ì€ **OFF**
- ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë“ˆì—ì„œ `@Component`, `@Service` ì‚¬ìš© **ê¸ˆì§€**
- ëª¨ë“  ë¹ˆì€ `@Configuration + @Bean` ê¸°ë°˜
- ë°˜ë“œì‹œ ì¡°ê±´ë¶€ ë“±ë¡
    - `@ConditionalOnProperty`
    - `@ConditionalOnMissingBean`
- Secrets ì¸í”„ë¼ì™€ **ì§ì ‘ ì˜ì¡´ ê¸ˆì§€**
- í‚¤(Base64 í¬í•¨)ëŠ” **ì ˆëŒ€ ë¡œê·¸ ì¶œë ¥ ê¸ˆì§€**

-------------------------------------------------------------------------------

## 4. CryptoInfraConfig ìƒì„¸

### 4.1 êµ¬ì„± ì—­í• 

- crypto.enabled=true ì‹œ ì „ì²´ ë¸”ë¡ í™œì„±í™”
- Encryptor / Hasher / Signer ë¹ˆ ë“±ë¡
- EncryptorFactory ì œê³µ
- SeedConfig ì„œë¸Œ êµ¬ì„± í¬í•¨

### 4.2 êµ¬ì„± ìš”ì•½

    CryptoInfraConfig
     â”œâ”€ Encryptor Beans
     â”‚  â”œâ”€ Aes128Encryptor
     â”‚  â”œâ”€ Aes256Encryptor
     â”‚  â””â”€ AesGcmEncryptor
     â”œâ”€ Hasher Beans
     â”‚  â”œâ”€ BcryptHasher
     â”‚  â”œâ”€ Argon2Hasher
     â”‚  â””â”€ Sha256Hasher
     â”œâ”€ Signer Beans
     â”‚  â””â”€ HmacSha256Signer
     â”œâ”€ EncryptorFactory
     â””â”€ SeedConfig (crypto.props.seed=true)

-------------------------------------------------------------------------------

## 5. ë™ì‘ ëª¨ë“œ

### 5.1 OFF (ê¸°ë³¸)

- crypto.enabled=false (ê¸°ë³¸ê°’)
- Crypto ì¸í”„ë¼ ì™„ì „ ë¹„í™œì„±
- ë‹¤ë¥¸ ëª¨ë“ˆì— ì˜í–¥ ì—†ìŒ

-------------------------------------------------------------------------------

### 5.2 ìˆ˜ë™(Manual) ëª¨ë“œ

    crypto:
      enabled: true
      props:
        seed: false

- Encryptor / Signer / Hasher / Factory ë¹ˆ ë“±ë¡
- í‚¤ëŠ” ì½”ë“œì—ì„œ ì§ì ‘ `setKey(base64)` í˜¸ì¶œ
- EncryptProperties ë¬´ì‹œ
- ë¡œì»¬ / í…ŒìŠ¤íŠ¸ / íŠ¹ìˆ˜ í™˜ê²½ì— ì í•©

-------------------------------------------------------------------------------

### 5.3 ìë™(Seed) ëª¨ë“œ

    crypto:
      enabled: true
      props:
        seed: true

    encrypt:
      aes128:
        key: BASE64_URL_SAFE_16B
      aes256:
        key: BASE64_URL_SAFE_32B
      aesgcm:
        key: BASE64_URL_SAFE_32B
      hmac:
        key: BASE64_URL_SAFE_32B

- InitializingBean ê¸°ë°˜ ìë™ ì‹œë”©
- ì¼ë¶€ ì•Œê³ ë¦¬ì¦˜ë§Œ ì§€ì •í•´ë„ í—ˆìš©(ë¶€ë¶„ ì‹œë”©)
- ìš´ì˜ í™˜ê²½ ê¸°ë³¸ ê¶Œì¥ ëª¨ë“œ

-------------------------------------------------------------------------------

### 5.4 Secrets ì—°ë™ í™•ì¥ (Core Only + Bridge)

- Crypto ëª¨ë“ˆ ìì²´ëŠ” Secretsì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
- ë³„ë„ Bridge ì»´í¬ë„ŒíŠ¸ì—ì„œ ì—°ë™

ë™ì‘ ê°œë…:

    SecretsLoader
      â””â”€ SecretKeyRefreshListener
           â””â”€ (Bridge)
                â”œâ”€ secrets.getKey(alias)
                â”œâ”€ Base64 ë³€í™˜
                â””â”€ encryptor/signer.setKey()

-------------------------------------------------------------------------------

## 6. ì•”í˜¸ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸

### 6.1 Encryptor (ëŒ€ì¹­í‚¤)

#### ê³µí†µ ê·œì¹™

- ì™¸ë¶€ Base64 í‚¤ ì£¼ì…
- ì¤€ë¹„ë˜ì§€ ì•Šìœ¼ë©´ ì¦‰ì‹œ ì˜ˆì™¸
- ê²°ê³¼ í¬ë§· í†µì¼

ì•”í˜¸ë¬¸ í¬ë§·:

    v1:Base64(IV || CIPHER)

#### ì•Œê³ ë¦¬ì¦˜ë³„ ì‚¬ì–‘

| ì•Œê³ ë¦¬ì¦˜ | Key | IV | Mode |
|--------|-----|----|------|
| AES128 | 16B | 16B | CBC |
| AES256 | 32B | 16B | CBC |
| AES-GCM | 32B | 12B | GCM |

-------------------------------------------------------------------------------

### 6.2 Signer (HMAC)

- HmacSha256Signer
- ìµœì†Œ 16ë°”ì´íŠ¸ í‚¤ ìš”êµ¬
- MessageDigest.isEqual ê¸°ë°˜ ìƒìˆ˜ì‹œê°„ ë¹„êµ

-------------------------------------------------------------------------------

### 6.3 Hasher (ë‹¨ë°©í–¥)

| êµ¬í˜„ì²´ | íŠ¹ì§• |
|------|------|
| BcryptHasher | Spring Security BCrypt |
| Argon2Hasher | ë©”ëª¨ë¦¬ 64MB, iteration 2 |
| Sha256Hasher | SHA-256 + Base64 |

- Stateless
- í•­ìƒ isReady() = true

-------------------------------------------------------------------------------

## 7. EncryptorFactory

### 7.1 ì—­í• 

- CryptoAlgorithmType ê¸°ë°˜ êµ¬í˜„ì²´ ì œê³µ
- ì•Œê³ ë¦¬ì¦˜ ë³€ê²½ ì‹œ ì„œë¹„ìŠ¤ ì½”ë“œ ìˆ˜ì • ìµœì†Œí™”

### 7.2 ì‚¬ìš© ì˜ˆ

    Encryptor enc = factory.getEncryptor(AES256);
    Signer sig = factory.getSigner(HMAC_SHA256);
    Hasher hasher = factory.getHasher(BCRYPT);

-------------------------------------------------------------------------------

## 8. í‚¤ ìƒì„± ìœ í‹¸

    String key = EncryptionKeyGenerator.generateKey(AES256);

- SecureRandom ê¸°ë°˜
- Base64 URL-safe ì¸ì½”ë”©
- ì•Œê³ ë¦¬ì¦˜ë³„ ì•ˆì „í•œ ê¸¸ì´ ìë™ ì ìš©

-------------------------------------------------------------------------------

## 9. í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### 9.1 ìˆ˜ë™ ëª¨ë“œ í…ŒìŠ¤íŠ¸

- crypto.props.seed=false
- setKey() ì§ì ‘ í˜¸ì¶œ
- encrypt â†’ decrypt ë™ì¼ì„± ê²€ì¦

-------------------------------------------------------------------------------

### 9.2 ìë™ ëª¨ë“œ í…ŒìŠ¤íŠ¸

- crypto.props.seed=true
- encrypt.*.key ì„¤ì •
- isReady() ê²€ì¦

-------------------------------------------------------------------------------

## 10. ë³´ì•ˆ ê¶Œì¥ì‚¬í•­ (ê°•ì œ)

- í‚¤ëŠ” ë°˜ë“œì‹œ Base64 URL-safe
- í‚¤ ê¸¸ì´ ì—„ê²© ì¤€ìˆ˜
    - AES128 = 16B
    - AES256 / AESGCM / HMAC = 32B
- í‚¤ ê°’/ì›ë¬¸/Base64 ë¡œê·¸ ì¶œë ¥ ê¸ˆì§€
- ìš´ì˜ í™˜ê²½ì€ Secrets Manager ì‚¬ìš© ê¶Œì¥
- í‚¤ êµì²´ ì‹œ ì´ì „ í‚¤ ì¦‰ì‹œ ë¡¤ë°± ê°€ëŠ¥ êµ¬ì¡° ìœ ì§€

-------------------------------------------------------------------------------

## 11. í´ë˜ìŠ¤ ê´€ê³„ë„ (ê°œë…)

    CryptoInfraConfig
     â”œâ”€ EncryptProperties (seed=true)
     â”œâ”€ Encryptor
     â”‚   â”œâ”€ Aes128Encryptor
     â”‚   â”œâ”€ Aes256Encryptor
     â”‚   â””â”€ AesGcmEncryptor
     â”œâ”€ Signer
     â”‚   â””â”€ HmacSha256Signer
     â”œâ”€ Hasher
     â”‚   â”œâ”€ BcryptHasher
     â”‚   â”œâ”€ Argon2Hasher
     â”‚   â””â”€ Sha256Hasher
     â””â”€ EncryptorFactory

-------------------------------------------------------------------------------

## 12. FAQ

Q1. Manual / Seed / Secretsë¥¼ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ê°€?  
A. ê°€ëŠ¥í•˜ë‹¤. ì¼ë¶€ëŠ” Seed, ì¼ë¶€ëŠ” Secrets, ë‚˜ë¨¸ì§€ëŠ” ìˆ˜ë™ ì£¼ì… ê°€ëŠ¥í•˜ë©°, ë¯¸ì‹œë”© ì•Œê³ ë¦¬ì¦˜ì€ isReady=false ìƒíƒœë¡œ ìœ ì§€ëœë‹¤.

Q2. Secrets ì—°ë™ ì‹œ ì„œë¹„ìŠ¤ ì½”ë“œ ë³€ê²½ì´ í•„ìš”í•œê°€?  
A. ì•„ë‹ˆë‹¤. Factory ê¸°ë°˜ í˜¸ì¶œì„ ìœ ì§€í•˜ë©´ Bridge ì¶”ê°€ë§Œìœ¼ë¡œ ì „í™˜ëœë‹¤.

-------------------------------------------------------------------------------

## 13. ìµœì¢… í•œ ì¤„ ìš”ì•½

ì´ ëª¨ë“ˆì€ **í•„ìš”í•  ë•Œë§Œ í™œì„±í™”ë˜ê³ **,  
í™œì„±í™”ë˜ë©´ **AES/HMAC/Hashë¥¼ í‘œì¤€í™”ëœ ë°©ì‹ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì œê³µ**í•˜ë©°,  
ì„¤ì •ë§Œìœ¼ë¡œ **Manual â†’ Seed â†’ Secrets ì—°ë™ê¹Œì§€ ìì—°ìŠ¤ëŸ½ê²Œ í™•ì¥**ëœë‹¤.
